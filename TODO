
********************************************************************************
                   			TODO LIST - SPECIFIC
********************************************************************************


#### SIGN-UP LINK ON CUSTOMER UI
********************************************************************
 
put a link on the Customer sign in page. 
"To sign up click here" where "here" links to  A2Billing_UI/signup

use of the new parameter in a2billing.conf

[webcustomerui]

; url of the signup page to show up on the sign in page (if empty no link will show up)
signup_page_url = http://localhost/~areski/svn/a2billing/trunk/A2Billing_UI/signup/
	


#### IVR VOUCHER
********************************************************************
No need to press 8 go directly to the option if user's credit is below the
minimum credit to call
new parameter
redirect_voucher_if_mincredit = yes or no
and it will be base on the minimum credit to make a call

maybe a voucher mode as callback instead



#### BUG : DID BILLING
********************************************************************
bug DID billing
we create a DID with no monthly cost for instance free or just dialout cost!!
When the use take the DID from the customer interface, it still have to pay for it
we dont check the billingtype of DID


#### BUG : DID  (not urgent)
********************************************************************
I Create a Card when I dont have  any DID Group
and I Simply Go and Create DID Group
and Create a Destination and Bind it with a Card
Go to the Client Side You will see the Destination in the Card
but when you will go to edit the Destination you will see the DIDGroup List is Not Loaded


#### FEATURE : REVIEW NEW DID MANAGEMENT
********************************************************************
Reservation and release
* To check


#### DOCUMENTATION : SMARTY & NEW DID MANAGEMENT
********************************************************************
- How smarty works and how to customize the design of a2billing with smarty and css.
  little guide about how to do it!
- Doc/DID_Billing.info to continue : make a detailed explanation of how to configure and use 
  the DID billing explain a real case when we need to sell DIDs through A2Billing


######## CURRENCY MANAGEMENT IN CRONT SERVICE 
********************************************************************
Currency management in cront service


#### RIGHT MANAGEMENT
********************************************************************
when u use this : "Add DID" and we assign a DID to a card
a check should be proceed, if the DID don't belong to the user's DID group then it should warn the user/admin


#### CALLBACK API_SPOOL_CALLBACK
********************************************************************
// USE RATE_ENGINE_FINDRATES - RATE_ENGINE_ALL_CALCULTIMEOUT - TARIFFGROUP BY DEFAULT TO FIND OUT THE CORRECT CHANNEL
$channel = 'SIP/'.$phone_number.'@toreplace';



#### GENERAL CHANGE IN CUSTOMER SIDE
********************************************************************
- to clean the code of those page invoices
- to remove the all the page used for pdf export like : A2B_entity_unbilled_summary1.php
  we should be able to deal with A2B_entity_unbilled_summary.php only and add a parameter mode for the pdf export.


#### CONSOLIDATE THE GETTEXT FILES
********************************************************************
  CONSOLIDATE THE GETTEXT FILES



#### a2billing.conf new section with all the log files
********************************************************************
handle this in different part of the application (API, AGI, Cront)



######## CREDIT RESERVE - SIMULTANEOUS ACCESS
********************************************************************

Wouldn't this mean on simultaneous access, callers could go negative in balance if subsequent calls were made while balance still exists?
http://forum.a2billing.net/viewtopic.php?t=1759&highlight=


Does the same account allow for simultaneous calls?
Yes. Here's how it works: Say you have a balance of ten (10) dollars. When your first call comes in, two hours worth of credit is temporarily frozen. So, if you are calling a destination that costs 2 cents a minute, that means $2.40 (2 cents/min x 120 minutes) has been frozen in your account. This leaves $7.60 available for another simultaneous call. When that second call comes in, more of your balance is frozen. You can keep making simultaneous calls so long as your effective balance is above zero. When calls are completed, the balance that was frozen is released and once again available for use. If you have a low balance, there's no sense in letting many simultaneous calls go through, only to have them all disconnect at the same time when your balance hits zero (what most carriers do).




######## DID RANGE 
********************************************************************
Add the same feature that is used on CID to add a new callerID
support range and coma



######## NOTE FROM CHRISTEAS : BACKUP DB
********************************************************************
giving apache the right to dump stuff is bad, IMHO.
So, you could have a crontab task backing up the database. 
That task could use a 'a2billing' system user, with the rights to connect to the database.




#### BUGS & CHECKS : DIVERS
********************************************************************
[FIXED]
1) Bug on edit entity (framework) keep transfered value in case of errors RegEx 

2) Reduce big space in top pages :
			A2B_entity_def_ratecard.php?atmenu=ratecard&stitle=RateCard&section=3
			CC_ratecard_import.php?atmenu=ratecard&stitle=RateCard&section=3
			
			Good high :
			A2B_entity_card.php?atmenu=card&stitle=Customers_Card&section=1
			

2) LIST CARDNUMBER -> REFILL : ARANGE FORMAT OF REFILL - remove the ugly red border
3) EDIT TARIFFGROUP -> add ratecard : reduce the border
4) Security check on update tariffgroup : not create code on tmp
5) Add new tables for reseller and callshop
%% ??

#### FEATURE : NEW CALLBACK SYSTEM
********************************************************************
long story


#### FEATURE : OPTIMIZE AGI TO USE PL/SQL functions for all important functions (couples of weeks)
******************************************************************************


#### FEATURE : LINK SIP/IAX FRIENDS TO THE CARD - iax/sip_friend_id
********************************************************************
???

#### FEATURE : ADD RANGE CARDNUMBER IN CARDGENERATOR
********************************************************************
let user define a range of cardnumber (ie: 45000-46000)
+ option to check if there is a cards already between this range (interval limit 10000)



#### FEATURE : PACKAGES SYSTEM - FREE MINUTES
********************************************************************
Situation :
We need to support a new relation call "FREE MINUTE" under kind of package according to the destination.
We have an example : http://www.blueface.ie/
There is several kind of packages :
- Unlimited UK/Ireland where they can call as much as they want to this destination and pay for the rest.
- 300 minutes free over 20 destinations + unlimited on Uk for instance
- 300 minutes free over 20 destinations
- pay as you go, standard

We have to add in A2Billing this relation... For the unlimited calls we already have the routes at 0 cost.
now we might need to assign the X free minutes relation over YZ destinations.


- 300 minutes free over 20 destinations + unlimited on Uk for instance
the relation unlimited is already defined in the rate-engine through the route with cost=0

we need to add new table :
table cc_package to define the type package & min free. 
CREATE TABLE cc_package_offer (
    id bigserial NOT NULL,
    creationdate timestamp without time zone DEFAULT now(),
    label text NOT NULL,
    packagetype int NOT NULL,
	billingtype int NOT NULL,
	startday int NOT NULL,
	freeminutes int NOT NULL
);
-- packagetype : Free minute + Unlimited ; Free minute ; Unlimited ; Normal
-- billingtype : Monthly ; Weekly 
-- startday : according to billingtype ; if monthly value 1-31 ; if Weekly value 1-7 (Monday to Sunday) 
I guess a field in cc_tariffgroup which will define the relation with cc_package_offer 
and a field in cc_ratecard to define if the rate will take advantage of the package offer (part of X min free)

We have also to think that the offer will be per month (per week, etc..) so we will need to keep the number of free-minutes used by month (period)
and by user/card, Customer have to have the offer for each time period (since the creation date).
Table cc_card_package (id_card, id_package_offer, time_used(secondes) )

CREATE TABLE cc_card_package_offer (
    id 					bigserial NOT NULL,
	id_cc_card 			bigint NOT NULL.
	id_cc_package_offer bigint NOT NULL,
    date_consumption 	timestamp without time zone DEFAULT now(),
	used_secondes 		bigint NOT NULL
);
CREATE INDEX ind_cc_card_package_offer_id_card ON cc_card_package_offer USING btree (id_cc_card);
CREATE INDEX ind_cc_card_package_offer_id_package_offer ON cc_card_package_offer USING btree (id_package_offer);
CREATE INDEX ind_cc_card_package_offer_date_consumption ON cc_card_package_offer USING btree (date_consumption);

ALTER TABLE cc_tariffgroup 	ADD COLUMN id_cc_package_offer BIGINT NOT NULL DEFAULT 0;
ALTER TABLE cc_ratecard 	ADD COLUMN freeminute_package_offer INT NOT NULL DEFAULT 0;


Other Billing difficulty : 
When we reach the limite, we will have part of the call inside the offer (so not billed) and the rest of the minutes should be billed...


CREATE TABLE cc_subscription_fee (
    id 				BIGSERIAL NOT NULL,
    label 			TEXT NOT NULL,	
	fee 			NUMERIC(12,4) NOT NULL,
	currency 		CHARACTER VARYING(3) DEFAULT 'USD'::character varying,
	status 			INTEGER NOT NULL DEFAULT 0,
    numberofrun 	INTEGER NOT NULL DEFAULT 0,
    datecreate 		timestamp(0) without time zone DEFAULT now(),
    datelastrun 	timestamp(0) without time zone DEFAULT now(),
    emailreport 	TEXT,
    totalcredit 	DOUBLE PRECISION NOT NULL DEFAULT 0,
    totalcardperform INTEGER NOT NULL DEFAULT 0
);
ALTER TABLE ONLY cc_subscription_fee
ADD CONSTRAINT cc_subscription_fee_pkey PRIMARY KEY (id);


ALTER TABLE cc_charge 	ADD COLUMN currency 				CHARACTER VARYING(3) DEFAULT 'USD'::CHARACTER VARYING;
ALTER TABLE cc_charge 	ADD COLUMN id_cc_subscription_fee 	BIGINT DEFAULT 0;


CREATE INDEX ind_cc_charge_id_cc_card				ON cc_charge USING btree (id_cc_card);
CREATE INDEX ind_cc_charge_id_cc_subscription_fee 	ON cc_charge USING btree (id_cc_subscription_fee);
CREATE INDEX ind_cc_charge_creationdate 			ON cc_charge USING btree (creationdate);


-- INSTEAD USE CC_CHARGE
CREATE TABLE cc_subscription_fee_card (
    id 						BIGSERIAL NOT NULL,
    id_cc_card 				BIGINT NOT NULL,
	id_cc_subscription_fee 	BIGINT NOT NULL,
    datefee 				TIMESTAMP(0) WITHOUT TIME ZONE DEFAULT now(),
    fee 					NUMERIC(12,4) NOT NULL,
	fee_converted			NUMERIC(12,4) NOT NULL,
	currency 				CHARACTER VARYING(3) DEFAULT 'USD'::CHARACTER VARYING
);
ALTER TABLE ONLY cc_subscription_fee_card
ADD CONSTRAINT cc_subscription_fee_card_pkey PRIMARY KEY (id);


CREATE INDEX ind_cc_subscription_fee_card_id_card ON cc_subscription_fee_card USING btree (id_card);
CREATE INDEX ind_cc_subscription_fee_card_id_cc_subscription_fee ON cc_card_package_offer USING btree (id_cc_subscription_fee);
CREATE INDEX ind_cc_subscription_fee_card_datefee ON cc_card_package_offer USING btree (datefee);



--- MENU ---
PACKAGE OFFER
	* List package Offer
	* Add package Offer
	* details by card

SERVICE
	* List subscription service
	* Add subscription service




?? ADD CC_SUBSCRIPTION_FEE & CC_CHARGE CHANGES IN MYSQL SCHEMAS

MISSING : 
- AGI
	http://trac.a2billing.net/cgi-bin/trac.cgi/changeset/789
	
	IF PACKAGE IN THE TARIFFGROUP
		0#	add freetimetocall_package_offer in select ratecard
		
		1# 	Get info from the package
			- billingtype ; startday ; freetimetocall
		2# 
			According to billingtype (monthly 0 ; weekly 1)
			if (monthly){
				if (startday > last day of the month) startday = last day of the month;
				if (startday <= 0 ) startday = 1;
				dateclause >= year-month-startday
			}else{// weekly
				startday = startday % 7 (modulo)
				if (currentdayofweek < startday) currentdayofweek++7
				diffday = currentdayofweek - startday (current lundi 1 - mercredi 3 = 5) 
				dateclause >= 				
				# mysql -> SELECT DATE_SUB('2003-07-13 00:00:00', INTERVAL 14 DAY);
				# mysql -> SELECT DATE_SUB(NOW(), INTERVAL 14 DAY);
				# psql  -> SELECT (date('2003-07-13 00:00:00') - interval '14 day');
				# psql  -> SELECT (now() - interval '14 day');				
			}
			SELECT  sum(used_secondes) AS used_secondes 
			FROM cc_card_package_offer
			WHERE (date_consumption) >= ('2007-02-01') AND id_cc_card = '%%%%%%%%%%%' AND id_cc_package_offer = '%%%%%%%%%%%'
			AND DATE_CLAUSE
			
			init freetimetocall_used
			freetimetocall_left = freetimetocall - freetimetocall_used
			
			### MAKE CALL ### 
			CHECK IF THE RATE HAVE "freetimetocall_package_offer" = Yes
			
			if (Yes && (TimeofCAll >0) && (freetimetocall_left > 0)){
					
					if (freetimetocall_left >= TIMEOFCALL) freetimetocall_used = TIMEOFCALL;
					else freetimetocall_used = freetimetocall_left;
					
					TIMEOFCALL = TIMEOFCALL - freetimetocall_used
					Before calculated the cost
					TIMEOFCALL = TIMEOFCALL + freetimetocall_used
					
					Add table cc_card_package_offer (...freetimetocall_used)
					add cc_call <- id_card_package_offer
			}
	
- CRONT
	- BROWSE ALL THE CUSTOMER THAT HAVE A SUBSCRIPTION FEE ENABLE
		SELECT * FROM cc_card LEFT JOIN cc_subscription_fee ON cc_card.id_subscription_fee=cc_subscription_fee.id WHERE cc_subscription_fee.status=1
	- Support multi currency
	- Add a charge for this user
		INSERT INTO cc_charge (id_cc_card, amount, chargetype, description) values ('1', '120', '3', 'description here...')
	- Decrement his balance
	
- ADD SELECT subscription fee on card 
ALTER TABLE cc_card ADD COLUMN id_subscription_fee INTEGER;


#### MIGRATE NEW FRAMEWORK : call-log-customers.php
********************************************************************
call-log-customers.php : use old way to display cdr table 




#### FEATURE : NEW INVOICING SYSTEM
********************************************************************
See Description mails - EXCEL
%% MA


#### WRITE DOCUMENTATION: API SHOW RATECARD -> 
********************************************************************
WRITE FULL DOCUMENTATION FOR :
trunk/A2Billing_UI/api/display_ratecard.php

#### WRITE DOCUMENTATION: ALARM SYSTEM
********************************************************************
See Changelog


#### FEATURE : jump_voucher_if_min_credit
********************************************************************
When the user credit are below the minimum credit to call min_credit 
we might have an option to decide if we jump directly to the voucher IVR menu instead of just disconecting

option in a2billing.conf
jump_voucher_if_min_credit = yes or no




#### FEATURE
********************************************************************
BATCH GENERATION OF INVOICE (Phuong)

need a feature that can allow admin to generate the invoice for all the postpaid or 
prepaid account with just one click.

right now, we have to go to Call Report/Invoice, and then select the respective month, 
and then select the card one by one, and then save the html page. And doing that 
repetitively for 100 cards is quite gruesome 

so auto generate invoice (with criteria) and maybe auto mailing, that will be cool



#### FEATURE
********************************************************************
thoughts to adding timezone to cc_card ? It's great that we've got language and currency so they can view items in their local currency. Why not have option for timezone so the CDR's are listed in their local times instead of where the switch is located?
I borrowed this idea from SER. I can get you their database table they use if you like. It makes it easy for user instead of asking for +/- GMT, has items such as:


#### FEATURE
********************************************************************
Marcel

- invoices: keep an end of the month balance and send automatically invoices at the end of the month using an email template and attaching a html invoice report; fields in the template would include name, last month balance, current month payments, current month per minute charges, DIDs and other charges, etc.

- payment: send payment emails to customers when "Add Payment" is used; send an email out of a template saying something like "thank you for payment of XXX made on YYYY...."; maybe the ability to display the payment history on the customer web site to see if they paid the bill or not 

"Add Payment" do not refill the account, you have to do refill manually.
- Adding a feature there to make an auto refill



#### FEATURE
********************************************************************
some info report
http://www.vbulletin.com/forum/showthread.php?threadid=3477


#### FEATURE
********************************************************************
ADD REPORTING PAGE TO VIEW :
- 20 users making the more call
- 20 more call destination

20 might be a parameters
we need to see the total time and sell made by this clause group
etc...



#### Feature
********************************************************************
Try to add some captcha into the sensible Form
http://www.nogajski.de/horst/php/captcha/index.php?download=yes&id=1234


#### NOTE
********************************************************************
Note to areski – should we be able to define international access prefixes? 00 UK & Europe, 
011 USA , but 0099 for South Africa. See http://kropla.com/dialcode.htm IDD column

Note to Areski – why have free as an option, surely if I wanted free, I would set fixrate to 0?



********************************************************************
To tidy up the box for filtering, can you either reduce the font size or use symbols only, e.g. >  ;   >=  ; <=


	
#### NEW TASK []
********************************************************************
Yep - having a separate figure for VAT would be useful
for VAT returns
however - UK VAT laws say that if a call originates outside of the EU, then no VAT is required on the call
however if a call starts within the EU, the VAT is payable

 





#### NEW TASK []
********************************************************************
Card company can set default language and customer can change 1. English 2. Dutch, 3. French
etc.
make it more easily customizable



#### NEW TASK []
********************************************************************
When removing a Card -> Check if SIP/IAX has been created if yes ask for confirmation.
1# we can add an id_card in the buddy table
2# we can add an id_sip id_iax in the cc_card table
find the best solution


#### NEW TASK - NEW button style []
********************************************************************
New button for edit/delete... really tiny but with text
New button for confirm Data


#### BUG []
********************************************************************

	Line 382 in a2billing.php has:
					   if (substr($A2B->CallerID,0,1)=='0'){
						   $A2B ->dnid = $A2B ->destination =
	$caller_areacode.substr($A2B->CallerID,1);
					   }else{
						   $A2B ->dnid = $A2B ->destination =
	$caller_areacode.$A2B->CallerID;
					   }
					   $agi->verbose('line:'.__LINE__.' - '.'[destination:
	- '.$A2B->destination.']');
	
	[a2billing-cid-callback]
	exten => _X.,1,DeadAGI(a2billing.php|1|cid-callback|34) ;last
	parameter is the callback area code
	exten => _X.,2,Hangup
	
	As u see the last parameter is the area code and from instance :
	if I am in Belgium and use a local DID for callback but my server are
	in UK, the system will probably not know that it needs to call me back
	over the prefix 32, that's why is needed.
	So in this case my cell number 0473510969, a2b will be call me as 32473510969.
	That s the meaning of the remaining zero and it makes sense to set a parameter 
	for the leading zero if you are
	already in the local country.




#### []
********************************************************************
Improve invoices system : let us store the generate invoice on the 
server. Define rules to send invoice at scheduled period



#### []
********************************************************************
Suggestion from Vahan
	1. First of all I'd suggest to introduce one single yet simple config
	option in a2billing.conf: silent=yes|no that allows to turn off all the
	voice prompts in the case a2billing.php has successfully authenticated
	the caller-id/card number and if the assosiated card number has enough
	credit. Currently you have to disable several announce configs for this.

	2. add an option to filter by first name / last name too in the card picker.

	3. Please first name to the list to as a separate column or merged with
	last name. It's difficult to track people by their lastnames only.
	Areski : I propose more to get rid of lastname and include a new feature to 
	roll over the row and get more info. it will keep up a clear design




#### []
********************************************************************
EXPORT CSV - REALLY CUSTOMIZABLE
EXPORT VOUCHER & EXPORT CARD
DEFINE CARD AND FIELD TO EXPORT ON FRAMEWORK


#### []
********************************************************************
BATCH UPDATE



#### []
********************************************************************
Edit card : date format


#### []
********************************************************************
There are problems with multiple calls if the credit is running low.
The system should secure a certain amount from the credit once the
user is logged in.


#### []
********************************************************************
2. auto-generation of both sip/iax accounts - think it cannot do
3. choice (in a2billing.conf) - friends in files or in asterisk realtime
4 - later - for realtime - link to existing users/peers (voiceone etc)



#### []
********************************************************************
- INVOICES MODULES (STORE ON SERVER - PRECOFIGURE RULES TO CREATE THEM)

Upgrade of the invoices html2pdf 
Store invoices on the server for different periode of time



#### []
********************************************************************
Move all the a2billing conf into the DB





#### []
********************************************************************
//// IMPORTANT 
Ben Pintilie <ben@energyradio.co.uk>
Going to offer professional recording :D
- rework on the IVR text 


#### [done-recheck]
********************************************************************
//// IMPORTANT 

Bug with DID in the customer interface
with mysql < 4 sub-select doesnt working
Replace the query

Database error: Invalid SQL: SELECT id, did, fixrate FROM cc_did WHERE id_cc_country=225 and id_cc_didgroup='1' and activated='1' and id NOT IN (select id_cc_did from cc_did_destination) ORDER BY did ASC
MySQL Error: 1064 (You have an error in your SQL syntax near 'select id_cc_did from cc_did_destination) ORDER BY did ASC' at line 1)




#### []
********************************************************************
Feature requests :
Print Voucher(s) (PDF ?)
Print Anonymous Prepaid Card (PDF ?)
Print Personal Prepaid/PostPaid Card (PDF ?)
Print Rates/Ratecard (adminUI)
Export Rates->PDF (customerUI)
Printing with custom company logo.




#### []
********************************************************************
e.) at the form of adding/changing SIP/IAX user there should be a possibilty to erase some parameters. like if there isn't any entry (example in canreinvite) that this also don't will be printed to the sip-config. Beause some parameter should be better to define in general without any possibility of overwriting

#### []
********************************************************************

d) different SIP/IAX files for each administrator/account- so with this there would be a possibility for a better differnece of two persons which handle the system and don't overwrite any manual config or/and a better usefull possibility for special definitions for the caller if he want to change like the "callerid" or anything else

#### []
********************************************************************
5.) BUG : if the debug level in /etc/asterisk/a2billing.conf will be activated to 1, 2 or 3 there sould be a DEBUG from the AGI-scripts to the log_file. But I've seen, that many debugging information will not be printed to the logfile.
 
So the statments "if ($A2B->agiconfig['debug']>=1) " don't work even the debug is set (i printed out the debug and I've seen it that the entry is correct. Maybe there is a mistake in the $agi->verbose but I don't looked there because it isn't so urgent to fix it.
 
Here is a example (the first line is from me and will printed out, the $A2B->agiconfig['debug'] = 2 but the two verbose don't will be printed to the log_file) :
 
# diff /var/lib/asterisk/agi-bin/a2billing.php
122c124
                                        $A2B -> write_log("[CREDIT STATUS : ".$A2B-> credit."]");
                                        if ($A2B->agiconfig['debug']>=1) $agi->verbose("[CREDIT STATUS : ".$A2B-> credit."]");
                                        if ($A2B->agiconfig['debug']>=1) $agi->verbose("[CREDIT MIN_CREDIT_2CALL : ".$A2B->agiconfig['min_credit_2call']."]");



#### []
********************************************************************
//// IMPORTANT 
Create a parameter in a2billing.conf format the number of decimal to display
in Misc.php -> number_format($var,2);


SWITCH ALL THE FLOAT IN MYSQL TO DECIMAL(12,6)
SWITCH ALL THE FLOAT IN POSTGRESQL TO NUMERIC(12,6)

ALTER TABLE cc_ratecard CHANGE buyrate buyrate DECIMAL( 12, 6 ) NOT NULL DEFAULT '0';

      

ALL HERE
ALTER TABLE `call` CHANGE `calledrate` `calledrate` DECIMAL( 12, 6 ) NULL DEFAULT NULL;
ALTER TABLE `call` CHANGE `sessionbill` `sessionbill` DECIMAL( 12, 6 ) NULL DEFAULT NULL;
ALTER TABLE `cc_card` CHANGE `credit` `credit` DECIMAL( 12, 6 ) NOT NULL DEFAULT '0';
ALTER TABLE `cc_ratecard` CHANGE `buyrate` `buyrate` DECIMAL( 12, 6 ) NOT NULL DEFAULT '0';
ALTER TABLE `cc_ratecard` CHANGE `rateinitial` `rateinitial` DECIMAL( 12, 6 ) NOT NULL DEFAULT '0';
ALTER TABLE `cc_ratecard` CHANGE `connectcharge` `connectcharge` DECIMAL( 12, 6 ) NOT NULL DEFAULT '0';
ALTER TABLE `cc_ratecard` CHANGE `disconnectcharge` `disconnectcharge` DECIMAL( 12, 6 ) NOT NULL DEFAULT '0';
ALTER TABLE `cc_ratecard` CHANGE `stepchargea` `stepchargea` DECIMAL( 12, 6 ) NOT NULL DEFAULT '0';
ALTER TABLE `cc_ratecard` CHANGE `chargea` `chargea` DECIMAL( 12, 6 ) NOT NULL DEFAULT '0';
ALTER TABLE `cc_ratecard` CHANGE `stepchargeb` `stepchargeb` DECIMAL( 12, 6 ) NOT NULL DEFAULT '0';
ALTER TABLE `cc_ratecard` CHANGE `chargeb` `chargeb` DECIMAL( 12, 6 ) NOT NULL DEFAULT '0';
ALTER TABLE `cc_ratecard` CHANGE `stepchargec` `stepchargec` DECIMAL( 12, 6 ) NOT NULL DEFAULT '0';
ALTER TABLE `cc_ratecard` CHANGE `chargec` `chargec` DECIMAL( 12, 6 ) NOT NULL DEFAULT '0';
ALTER TABLE `cc_service` CHANGE `amount` `amount` DECIMAL( 12, 6 ) NOT NULL DEFAULT '0';
ALTER TABLE `cc_service` CHANGE `totalcredit` `totalcredit` DECIMAL( 12, 6 ) NOT NULL DEFAULT '0';
ALTER TABLE `cc_service_report` CHANGE `totalcredit` `totalcredit` DECIMAL( 12, 6 ) NULL DEFAULT NULL;
ALTER TABLE `cc_voucher` CHANGE `credit` `credit` DECIMAL( 12, 6 ) NOT NULL DEFAULT '0';
 

#### []
********************************************************************
Petite question: je suis entrain de mettre en place des routes et ai
trouvé un truc que tu pourrais incorporer d'origine: un TRUNK nommé
NotAllowed (exemple), ProvideIP=NoProvider. Dans les scripts, lorsque tu
rencontres ce peer, soit tu ne fais rien et envois le message - le
numéro composé n'est pas disponible - ce qui est le cas actuellement
parceque * ne trouve pas ce host et renvoit un code erreur a A2Billing,
soit tu permets d'appeller une extension de type 100@default ou
Local/default/200 ou ... qui permettrait de personnaliser l'annonce/le
traitement.

Pourquoi je pense à ca? Prenons la FR comme ex: les routes vers les
numéros 8xx. sont compliquées: soit c'est gratuit (Freebox et consors)
soit c'est ultra-payant :-( Si je dois autoriser les règles une à une,
ca se complique. Avec ce système, j'interdis (donc TRUNK=NotAllowed) la
destination 338 puis je n'ouvre que les routes 338x que je veux ;-)



#### []
********************************************************************

> Since you support simultaneous calls on the same acountcode, It would be
> nice if the CustomerUI displayed CallerID and also be able to search on and
> sort on that column. Would be nice.  This way we can segegrate within the
> same account.


#### []
********************************************************************

When Making a call that is not answered, after timeout : no explanation,
just a busy tone/Hangup (voice prompt would be nice)

Callback : Allow/Deny pr user

Rates : it should be possible to enter rates in different currencies for
each ratecard.

I have 3 providers : a danish who list prices in DKK, a english who
lists prices in EUR, and a US who list prices in USD.

I think you can see my problem.

DID : answer with voice on unassigned did.


Needed DID improvement :
;played when receiving call on DID with no assigned destination
did_not_assigned_snd=



#### [Update-local-text-files]
********************************************************************

DOCUMENTATION

from your web site

cp -rf libs_a2billing /var/lib/asterisk/agi-bin/.
should be
cp -rf libs_a2billing/* /var/lib/asterisk/agi-bin/.
or u will miss 2 files in the folder

likewise from your website
cp  sounds/en/* /var/lib/asterisk/sounds/.
can be
cp  sounds/en/* /var/lib/asterisk/sounds/. < yes.txt
if u want to automate in a script

 
------------

1) Your system has a term of credit and credit limit. In fact the field that
has name CREDIT in your system in official terms of professional billing
systems has name ACCOUNT BALANCE. So the right name for this field could be
BALANCE. This balance can be positive and negative. The field name CREDIT is
not so correct because positive condition of account is not credit in fact,
this is DEBIT account, the CREDIT takes a place only when the user has
negative condition of his account balance. Credit limit only shows the
amount of negative condition of account balance. In other cases talking
about credit is not right way because in fact it is not credit. This also
could be better if credit customer could hear in the voice the real state of
his account balance not just a sum of real payed money plus credit limit but
only the number in BALANCE(CREDIT in your version) field. Talking the sum of
money and credit limit don't give customers the real info if he has a debt
of not. If the customer has a debt most calling card platforms say "balance
of your account is minus blah blah blah".



#### []
********************************************************************
beyond my means and ability to be able to modify the code to make a2billing
charge a fixed amount eg: 5cents per minute. for sip to sip calls... :(


#### []
********************************************************************
//// IMPORTANT 
Add new reporting

i also made little changes according to my poor understanding,  in call-log.php ( u sent me with billsec display)
$QUERY = "SELECT substring(calldate,1,10) AS day, sum(billsec) AS calltime, count(*) as nbcall FROM cdr WHERE disposition LIKE 'ANSWERED' AND ".$FG_TABLE_CLAUSE." GROUP BY substring(calldate,1,10)"; //extract(DAY from calldate)
replaced duration with billsec   to display billsec sum in bottom summery and to view correct ACT  i added  where disposion  like answered
cos ACD  =  can be calculated with answered calls    and i am also looking to add ASR formula in it


#### []
********************************************************************
//// IMPORTANT 
- and kindly  do add   the option to   take backup of rates tables  etc...
- and very important batch options  for all fields



#### []
********************************************************************
FOR THE WIKI

aka mantic




Importing Rate Cards

To import rate cards, your cvs file has to be formatted in a specific
way.

1 Obtain your vendors rates in cvs.

2 Open it in your favorite spreadsheet or database editor.

3 Find and arrange the columns so that the first three are:
      dialprefix - dial prefix
      destination - country
      rate initial - how much you charge

4 Find any of the other fields in your file that have data such as:
      buyrate - how much you pay provider per minute
      buyrateinitblock - minimum time provider bills you
      buyrateincrement - billing time increment from provider
      initblock - minimum time your bill caller
      billingblock - billing time increment to caller
      connect charge  - connect charge to caller
      disconnect charge - disconnect charge to caller
(there are additional fields not listed here available as
well.)                          Once you have found them, I would
suggest renameing them
appropriately                           to lessen confusion.
You may also find some cvs files have the country and city code in
seperate fields, you going to have to append the latter to the first
and call it dialprefix.

5 Check that the field arrangement has the following order: dialprefix,
destination, rate initial
Additional fields can be in any order you like, but take note of the
order for later.

6 Preparing the file to import.
The file has to be cvs format. Comma seperated format, but we cant use
commas. The accepted characters are:
';'  ':'  '-'  '\t'
You must save the file using one of the above as the seperator.
On my mac, I used excel to edit the file and bbedit to find and replace
all ',' with ';' and save in the Unix Unicode UT8 format.
Your file should look like this:

dialprefix;destination;rate initial;buyrate;initblock
119370;afghanistan cellular;0.8135;0.3135;30
1193;afghanistan proper;0.7866;0.2866;30
1135538;albania cellular;0.7076;0.2076;30

7. Open the a2billing page in your browser. Find Import RateCard.
'Choose the ratecard to import', 'Choose the trunk to use'.
'Choose the additionnal field that you want to import from your cvs
file.'
Here you will add any additional fields you described in the file.
Select the field and use the right green arrow to bring over. Do this
for all fields you have in the file. Make sure they are in the order
you noted earler. Make any order adjustments by selecting and using the
red up/down arrows to move.

8 Once you are finished "Choose File" and then "Import RateCard". If
all is well
you will see all of your field headers match up. Once you confirm they
do, hit "Continue to Import the RateCard". (It may ask you to select
the file again)

9 You will then get a confirmation of how many rates were successfully
imported.

/////////////////////////////////////////////////////


WIKI TO HAVE + SEVERAL A2B ON THE SAME BOX
------------------------------------------------------------------

Yes, you can program in a2billing.conf several configurations but only
to set different behaviour for the "agi" not for the rest of the
system.

Well in your case if you want to make coexist 2+ a2billing platforms
on the same box,
you will have to trick a little bit. There is a file call
Class.A2Billing.php in each components (web, agi, web-cust) and at the
beginning of it there is the definition to select the conf files

define('AST_CONFIG_DIR', '/etc/asterisk/');
...
define('DEFAULT_A2BILLING_CONFIG', AST_CONFIG_DIR . '/a2billing.conf');


so you can create a new db
duplicate the web interface in other directory and all files for the agi and
for instance copy those last in /var/lib/asterisk/agi-bin/namecustomer/

change the file
/var/lib/asterisk/agi-bin/namecustomer/libs_a2billing/Class.A2Billing.php

with for instance
define('DEFAULT_A2BILLING_CONFIG', AST_CONFIG_DIR .
'/a2billing.namecustomer.conf');

etc...

/////////////////////////////////////////////////////





********************************************************************
                   TODO LIST - GENERAL
********************************************************************


 
- MULTI CURRENCY FOR THE RECURRING SERVICE (maybe better to leave it like that)

- CUSTOM WELCOM MESSAGE

- CUSTOM ALL THE MESSAGE FROM WEB

- PASS PART OF THE CONFIGURATION ON THE DB

- CALLSHOP

- RESELLERS MODULE
http://www.voipswitch.com/reselleapplication.htm

- C MODULE (NON_AGI BASED) OR AEL

- CLASS_ENTITY

- KEEP TRACK OF THE COST - CALCULATE EARNING

- MAKE A GLOBAL VISUALISATION OF ASR - GLOBAL COST - EARNINGS (AGILE BILLING)
  REPORT ASR 
  
- SUPPORT ARA

- EXPORT RATES

- WHOLESALES (http://admin.coreswitch.com)

- Flash Operator Panel integration of additional_a2billing_SIP/IAX.conf

- Cront Manager 



2) In most billing systems identification of customer is not associated with
PIN code. Most usual and flexible way is to add the term of account.  The
account has associated with it PIN codes, CLIDs and other methods of
providing services. For example you have a corporative customer that is
company with 15 employees. These all people use PIN codes, their cell phones
callerids also used for access. They just call and call but money for calls
everytime taken from ONE account and they don't have to think about their
personal account balance, the company has one account for all PINs and
CLIDs. This is usual practise for most billing systems. This
company-customer can get the report in any time and look how many calls were
made by employees and how much money they spent from the account and how
many money were spent by all employees instead of looking the personal
accounts of all employees.

#### [work-in-progress]
********************************************************************
//// IMPORTANT BUT WE WAIT FOR THE WIKI
 - Review Documentation about installation ( many missing , errors ) ? ( or maybe not ... :-D ).

#### []
********************************************************************

 - Make a javascript wrappers to be sure that correct selections have been done for all script
   where there's a search button . Also avoid or just warn to user when it select a Range but use
   check out checkboxes from other selection i.ex :

   Selection of the month ( selected ) but check out checkboxes from Selection of the day .

#### []
********************************************************************

 - Allow set timezone in a2billing 

#### []
********************************************************************
 - Add a .htaccess with php options i.ex : register_globals off , etc ... ( and also to protect the site maybe ? ).

#### []
********************************************************************
 - Create a web base installation like many php projects do . ( no hurry at all ).

#### []
*******************************************************************
//// IMPORTANT 
 - Verify the design in IE , seems that doesn't like some CSS.

#### [done-check-postgresql]
 - Need to check possible problems with differents versions of MYSQL , the inserts for timestamps has been
 fixeds but not update and others.


#### []
*******************************************************************
//// IMPORTANT

Check Call Report.

#### []
*******************************************************************

Fix the generation of pdf avoid to use ob_* functions and generate the pdf to disk
so we avoid the problem of php memory exausting.
